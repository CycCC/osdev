// ------------------------------------------------------------------------------------------------
// pci_driver.c
// ------------------------------------------------------------------------------------------------

#include "pci_driver.h"
#include "io.h"

#include "eth_8254x.h"
#include "uhci.h"

// ------------------------------------------------------------------------------------------------
PCI_Driver pci_driver_table[] =
{
    { eth_8254x_init },
    { uhci_init },
    { 0 },
};

// ------------------------------------------------------------------------------------------------
u8 pci_in8(uint id, uint reg)
{
    u32 addr = 0x80000000 | id | (reg & 0xfc);
    out32(PCI_CONFIG_ADDR, addr);
    return in8(PCI_CONFIG_DATA + (reg & 0x03));
}

// ------------------------------------------------------------------------------------------------
u16 pci_in16(uint id, uint reg)
{
    u32 addr = 0x80000000 | id | (reg & 0xfc);
    out32(PCI_CONFIG_ADDR, addr);
    return in16(PCI_CONFIG_DATA + (reg & 0x02));
}

// ------------------------------------------------------------------------------------------------
u32 pci_in32(uint id, uint reg)
{
    u32 addr = 0x80000000 | id | (reg & 0xfc);
    out32(PCI_CONFIG_ADDR, addr);
    return in32(PCI_CONFIG_DATA);
}
